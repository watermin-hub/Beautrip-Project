# Supabase í•µì‹¬ í…Œì´ë¸” ì¡°ì¸ê´€ê³„ ë¬¸ì„œ (ERD/ì¡°ì¸í‚¤ í‘œ)

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” Beautrip í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” Supabaseì˜ 4ê°œ í•µì‹¬ í…Œì´ë¸” ê°„ ì¡°ì¸ ê´€ê³„ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ—‚ï¸ í…Œì´ë¸” ëª©ë¡

1. **treatment_master** - ì‹œìˆ  ë§ˆìŠ¤í„° ë°ì´í„°
2. **hospital_master** - ë³‘ì› ë§ˆìŠ¤í„° ë°ì´í„°
3. **category_treattime_recovery** - ì¹´í…Œê³ ë¦¬ë³„ ì‹œìˆ  ì‹œê°„/íšŒë³µ ê¸°ê°„ ë°ì´í„°
4. **keyword_monthly_trends** - í‚¤ì›Œë“œ ì›”ë³„ íŠ¸ë Œë“œ ë°ì´í„°

---

## ğŸ“Š ERD ë‹¤ì´ì–´ê·¸ë¨ (ì‹œê°í™”)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      treatment_master               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: treatment_id                    â”‚
â”‚     treatment_name                  â”‚
â”‚     hospital_name â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     category_large             â”‚    â”‚
â”‚     category_mid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚     category_small          â”‚   â”‚    â”‚
â”‚     selling_price           â”‚   â”‚    â”‚
â”‚     rating                  â”‚   â”‚    â”‚
â”‚     review_count            â”‚   â”‚    â”‚
â”‚     ...                     â”‚   â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”˜
                              â”‚   â”‚
                              â”‚   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚
                    â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  hospital_master           â”‚  â”‚ category_treattime_recovery â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ PK: hospital_id            â”‚  â”‚ ì¤‘ë¶„ë¥˜ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚     hospital_name â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ íšŒë³µê¸°ê°„_min(ì¼)             â”‚
    â”‚     platform                 â”‚ íšŒë³µê¸°ê°„_max(ì¼)             â”‚
    â”‚     hospital_rating          â”‚ ì‹œìˆ ì‹œê°„_min(ë¶„)             â”‚
    â”‚     review_count             â”‚ ì‹œìˆ ì‹œê°„_max(ë¶„)             â”‚
    â”‚     hospital_address         â”‚ ë‹¤ìš´íƒ€ì„ë ˆë²¨                 â”‚
    â”‚     ...                      â”‚ ...                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   keyword_monthly_trends            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     keyword                         â”‚
â”‚     month                           â”‚
â”‚     trend_count                     â”‚
â”‚                                     â”‚
â”‚  (ë…ë¦½ í…Œì´ë¸”, ì§ì ‘ ì¡°ì¸ ì—†ìŒ)      â”‚
â”‚  (í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰/íŠ¸ë Œë“œ ë¶„ì„ìš©)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— ì¡°ì¸ ê´€ê³„ ìƒì„¸

### 1. treatment_master â†” hospital_master

**ì¡°ì¸ í‚¤ (Join Key)**

- `treatment_master.hospital_name` = `hospital_master.hospital_name`

**ì¡°ì¸ íƒ€ì…**

- LEFT JOIN (1:N ê´€ê³„ - í•˜ë‚˜ì˜ ë³‘ì›ì€ ì—¬ëŸ¬ ì‹œìˆ ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ)
- ë¬¸ìì—´ ë§¤ì¹­ (ì •í™• ì¼ì¹˜)

**ì‚¬ìš© í•¨ìˆ˜**

- `extractHospitalInfo()` - ì‹œìˆ  ë°ì´í„°ì—ì„œ ë³‘ì› ì •ë³´ ì¶”ì¶œ
- `loadHospitalTreatments()` - íŠ¹ì • ë³‘ì›ì˜ ëª¨ë“  ì‹œìˆ  ì¡°íšŒ

**ì½”ë“œ ìœ„ì¹˜**

```typescript
// lib/api/beautripApi.ts:695-760
export function extractHospitalInfo(treatments: Treatment[]): HospitalInfo[] {
  // hospital_nameìœ¼ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ë³‘ì› ì •ë³´ ì§‘ê³„
  const hospitalMap = new Map<string, HospitalInfo>();
  treatments.forEach((treatment) => {
    const hospitalName = treatment.hospital_name;
    // hospital_name ê¸°ì¤€ìœ¼ë¡œ ë§¤ì¹­
  });
}
```

**ì˜ˆì‹œ ì‚¬ìš© ì¼€ì´ìŠ¤**

- ë³‘ì›ë³„ ì‹œìˆ  ëª©ë¡ ì¡°íšŒ
- ë³‘ì› í‰ê·  í‰ì  ê³„ì‚° (í•´ë‹¹ ë³‘ì›ì˜ ëª¨ë“  ì‹œìˆ  í‰ì  ì§‘ê³„)
- ë³‘ì›ë³„ ë¦¬ë·° ìˆ˜ í•©ê³„ ê³„ì‚°

---

### 2. treatment_master â†” category_treattime_recovery

**ì¡°ì¸ í‚¤ (Join Key)**

- `treatment_master.category_mid` = `category_treattime_recovery.ì¤‘ë¶„ë¥˜`

**ì¡°ì¸ íƒ€ì…**

- LEFT JOIN (1:1 ê´€ê³„ - í•˜ë‚˜ì˜ ì¤‘ë¶„ë¥˜ëŠ” í•˜ë‚˜ì˜ íšŒë³µ ê¸°ê°„ ì •ë³´ë¥¼ ê°€ì§)
- ë¬¸ìì—´ ë§¤ì¹­ (ì •í™• ì¼ì¹˜ ìš°ì„ , ë¶€ë¶„ ì¼ì¹˜ fallback, ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)

**ì‚¬ìš© í•¨ìˆ˜**

- `getRecoveryInfoByCategoryMid()` - ì¤‘ë¶„ë¥˜ë¡œ íšŒë³µ ê¸°ê°„ ì •ë³´ ì¡°íšŒ
- `getScheduleBasedRecommendations()` - ì¼ì • ê¸°ë°˜ ì‹œìˆ  ì¶”ì²œ

**ì½”ë“œ ìœ„ì¹˜**

```typescript
// lib/api/beautripApi.ts:319-440
export async function getRecoveryInfoByCategoryMid(categoryMid: string) {
  const recoveryData = await loadCategoryTreatTimeRecovery();

  // ì¤‘ë¶„ë¥˜ ì»¬ëŸ¼ê³¼ category_midë¥¼ ë§¤ì¹­
  const matched = recoveryData.find((item) => {
    const ì¤‘ë¶„ë¥˜ = (item.ì¤‘ë¶„ë¥˜ || "").trim();

    // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš°
    if (ì¤‘ë¶„ë¥˜ === categoryMidTrimmed) return true;

    // ë¶€ë¶„ ì¼ì¹˜ë„ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
    return (
      ì¤‘ë¶„ë¥˜.toLowerCase().includes(categoryMidTrimmed.toLowerCase()) ||
      categoryMidTrimmed.toLowerCase().includes(ì¤‘ë¶„ë¥˜.toLowerCase())
    );
  });
}
```

**ë§¤ì¹­ ë¡œì§**

1. ë¨¼ì € ì •í™• ì¼ì¹˜ í™•ì¸ (`ì¤‘ë¶„ë¥˜ === category_mid`)
2. ì •í™• ì¼ì¹˜ ì—†ìœ¼ë©´ ë¶€ë¶„ ì¼ì¹˜ í™•ì¸ (ì–‘ë°©í–¥, ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
3. ë§¤ì¹­ë˜ë©´ íšŒë³µ ê¸°ê°„(min/max), ì‹œìˆ  ì‹œê°„(min/max) ë°˜í™˜

**ì˜ˆì‹œ ì‚¬ìš© ì¼€ì´ìŠ¤**

- ì‹œìˆ  ìƒì„¸ í˜ì´ì§€ì—ì„œ íšŒë³µ ê¸°ê°„ í‘œì‹œ
- ì—¬í–‰ ì¼ì • ê¸°ë°˜ ì‹œìˆ  ì¶”ì²œ (íšŒë³µ ê¸°ê°„ì´ ì—¬í–‰ ì¼ìˆ˜ ì´ë‚´ì¸ ì‹œìˆ  í•„í„°ë§)
- ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  íšŒë³µ ê¸°ê°„ ê³„ì‚°

---

### 3. keyword_monthly_trends

**ì¡°ì¸ ê´€ê³„**

- í˜„ì¬ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ ì§ì ‘ì ì¸ Foreign Key ì¡°ì¸ ì—†ìŒ
- ë…ë¦½ í…Œì´ë¸” (í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ë° íŠ¸ë Œë“œ ë¶„ì„ìš©)

**ì‚¬ìš© í•¨ìˆ˜**

- `loadKeywordMonthlyTrends()` - í‚¤ì›Œë“œ íŠ¸ë Œë“œ ë°ì´í„° ë¡œë“œ

**ì˜ˆì‹œ ì‚¬ìš© ì¼€ì´ìŠ¤**

- í‚¤ì›Œë“œë³„ ê²€ìƒ‰ íŠ¸ë Œë“œ ë¶„ì„
- ì›”ë³„ ì¸ê¸° í‚¤ì›Œë“œ í†µê³„
- í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ìë™ì™„ì„± (í–¥í›„ êµ¬í˜„ ê°€ëŠ¥)

---

## ğŸ“ ì¡°ì¸í‚¤ ìš”ì•½í‘œ

| ê´€ê³„            | í…Œì´ë¸” A         | ì»¬ëŸ¼ A        | í…Œì´ë¸” B                    | ì»¬ëŸ¼ B        | ì¡°ì¸ íƒ€ì…       | ë§¤ì¹­ ë°©ì‹      |
| --------------- | ---------------- | ------------- | --------------------------- | ------------- | --------------- | -------------- |
| ì‹œìˆ  â†” ë³‘ì›     | treatment_master | hospital_name | hospital_master             | hospital_name | LEFT JOIN (1:N) | ì •í™• ì¼ì¹˜      |
| ì‹œìˆ  â†” íšŒë³µê¸°ê°„ | treatment_master | category_mid  | category_treattime_recovery | ì¤‘ë¶„ë¥˜        | LEFT JOIN (1:1) | ì •í™•/ë¶€ë¶„ ì¼ì¹˜ |

---

## ğŸ” ì£¼ìš” ì¡°ì¸ íŒ¨í„´

### íŒ¨í„´ 1: ì‹œìˆ  + ë³‘ì› ì •ë³´ ì¡°ì¸

```typescript
// treatment_master ë°ì´í„°ì—ì„œ hospital_name ì¶”ì¶œ
const treatments = await loadTreatments();

// hospital_nameìœ¼ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ë³‘ì› ì •ë³´ ì§‘ê³„
const hospitalInfo = extractHospitalInfo(treatments);
// â†’ hospital_name ê¸°ì¤€ìœ¼ë¡œ treatmentë“¤ì„ ë¬¶ì–´ì„œ í‰ê·  í‰ì , ì´ ë¦¬ë·° ìˆ˜ ê³„ì‚°
```

### íŒ¨í„´ 2: ì‹œìˆ  + íšŒë³µ ê¸°ê°„ ì •ë³´ ì¡°ì¸

```typescript
// treatmentì˜ category_midë¡œ íšŒë³µ ê¸°ê°„ ì •ë³´ ì¡°íšŒ
const treatment = await loadTreatmentById(treatmentId);
const recoveryInfo = await getRecoveryInfoByCategoryMid(treatment.category_mid);
// â†’ íšŒë³µ ê¸°ê°„, ì‹œìˆ  ì‹œê°„ ì •ë³´ ë°˜í™˜
```

### íŒ¨í„´ 3: ì¼ì • ê¸°ë°˜ ì¶”ì²œ (ë³µí•© ì¡°ì¸)

```typescript
// 1. treatment_master í•„í„°ë§ (ì¹´í…Œê³ ë¦¬, ì¼ì •)
const filteredTreatments = treatments.filter(...);

// 2. category_midë¡œ ê·¸ë£¹í™”
const midCategoryMap = new Map<string, Treatment[]>();

// 3. ê° ì¤‘ë¶„ë¥˜ë³„ë¡œ category_treattime_recovery ì¡°íšŒ
for (const [categoryMid, treatmentList] of midCategoryMap) {
  const recoveryInfo = await getRecoveryInfoByCategoryMid(categoryMid);
  // â†’ ì¼ì •ì— ë§ëŠ” ì‹œìˆ  ì¶”ì²œ
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë¬¸ìì—´ ë§¤ì¹­ì˜ í•œê³„

- `hospital_name`ê³¼ `category_mid`ëŠ” ëª¨ë‘ ë¬¸ìì—´ í•„ë“œë¡œ ë§¤ì¹­ë˜ë¯€ë¡œ:
  - ì² ì ì˜¤ë¥˜ë‚˜ ê³µë°± ì°¨ì´ë¡œ ì¸í•œ ë§¤ì¹­ ì‹¤íŒ¨ ê°€ëŠ¥
  - ëŒ€ì†Œë¬¸ì ì°¨ì´ëŠ” ì²˜ë¦¬ë˜ì§€ë§Œ, ê³µë°± ì²˜ë¦¬ëŠ” ì£¼ì˜ í•„ìš”

### 2. category_treattime_recovery ë§¤ì¹­

- `ì¤‘ë¶„ë¥˜` ì»¬ëŸ¼ê³¼ `category_mid` ë§¤ì¹­ ì‹œ:
  - ì •í™• ì¼ì¹˜ ìš°ì„ , ë¶€ë¶„ ì¼ì¹˜ fallback
  - ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ null ë°˜í™˜ (ì—ëŸ¬ ì•„ë‹˜)
  - ë°ì´í„° ì •í•©ì„± í™•ì¸ í•„ìš”

### 3. ë°ì´í„° ì •í•©ì„±

- `hospital_name`ì´ ë‘ í…Œì´ë¸”ì— ëª¨ë‘ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
- `category_mid`ì— í•´ë‹¹í•˜ëŠ” íšŒë³µ ê¸°ê°„ ì •ë³´ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
- â†’ LEFT JOINì´ë¯€ë¡œ NULL ê°’ ì²˜ë¦¬ í•„ìš”

---

## ğŸ“Œ í–¥í›„ ê°œì„  ë°©ì•ˆ

1. **Foreign Key ì¶”ê°€ ê³ ë ¤**

   - í˜„ì¬ëŠ” ë¬¸ìì—´ ë§¤ì¹­ì´ì§€ë§Œ, ì‹¤ì œ FK ê´€ê³„ë¡œ ì „í™˜ ê²€í† 
   - ë°ì´í„° ì •í•©ì„± ë³´ì¥ì„ ìœ„í•œ ì œì•½ì¡°ê±´ ì¶”ê°€

2. **keyword_monthly_trends í™œìš© í™•ëŒ€**

   - treatment_masterì˜ treatment_name, category_smallê³¼ í‚¤ì›Œë“œ ë§¤ì¹­
   - í‚¤ì›Œë“œ ê¸°ë°˜ ìë™ì™„ì„± ë° ê²€ìƒ‰ ê¸°ëŠ¥ ê°•í™”

3. **ì¸ë±ìŠ¤ ìµœì í™”**
   - `hospital_name`, `category_mid` ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì¶”ê°€ ê³ ë ¤
   - ì¡°ì¸ ì„±ëŠ¥ ê°œì„ 

---

## ğŸ“… ë¬¸ì„œ ì‘ì„±ì¼

- ì‘ì„±ì¼: 2025-12-15
- ì‘ì„±ì: AI Assistant
- ë²„ì „: 1.0
